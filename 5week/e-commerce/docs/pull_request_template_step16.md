# Chapter. 3-3 대용량 트래픽&데이터 처리

-----------------------------------------------------------------------------------------------------------------
### STEP 16 Transaction Diagnosis

- 우리 서비스의 규모가 확장되어 MSA의 형태로 각 도메인별로 배포 단위를 분리해야한다면 각각 어떤 도메인으로 배포 단위를 설계할 것인지 결정하고, 그 분리에 따른 트랜잭션 처리의 한계와 해결방안에 대한 서비스 설계 문서 작성하여 제출합니다.
-----------------------------------------------------------------------------------------------------------------

### 서비스 도메인 MSA 분리 설계 및 트랜잭션 처리 전략

현재 서비스는 모놀리식(Spring 기반)의 단일 애플리케이션으로 구성되어 있으며, 주문/결제, 유저 관리, 상품, 재고, 쿠폰 등의 도메인이 하나의 DB와 트랜잭션으로 관리되고 있어
도메인 기반 MSA 구조로 전환시 도메인 별 분리 및 배포 단위를 정해야 한다.


## 도메인 분리 및 배포 단위

도메인 이름         | 주요 책임 및 기능

- User-Service     | 유저 정보, 로그인/회원가입, 잔액/포인트 관리

- Product-Service  | 상품 정보 관리 (가격, 재고, 차감/복구 등)

- Order-Service    | 주문 생성, 주문 내역 조회, 주문 상태 변경

- Coupon-Service   | 쿠폰 발급, 사용, 쿠폰 검증

## 문제사항

- 도메인 별 DB분리 시 자원, 트랜잭션을 공유 하지 못하는 이슈가 발생
- rollback, commit, lock 사용(x)

## 해결 방안
### SAGA 패턴 (Choreography)
- 사용하여 각 서비스가 로컬 트랜잭션을 실행후 이벤트 발행 -> 구독 처리
이셉션 발생시 보상 트랜잭션 실행 하는 방식으로 구성

- 주문 요청 시작 → 재고 차감 요청 → 주문 저장 요청 → 유저 잔액 차감 요청  

### 보상 트랜잭션 구조 (Compensating Transaction)
- User-Service에서 잔액 차감 실패 → Stock-Service에 재고 복구 요청

### 비동기 이벤트 기반 처리
- Kafka 메시지 브로커 기반의 도메인 이벤트 발행

- 재고차감 event -> 주문 event -> 포인트 차감 event
- 재고 롤백 event <-주문 제거 event<- 포인트 차감(이셉션 발생)
-----------------------------------------------------------------------------------------------------------------
수정할 점
    
    
    
    

질문 
    
    
    